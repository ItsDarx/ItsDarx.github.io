<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <style>
        body {
            margin: 0;
            padding: 0;
            background-image: url('https://www.xtrafondos.com/wallpapers/gta-vi-grand-theft-auto-6-12062.jpg');
            /* Ruta de tu imagen de fondo */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            font-family: Arial, sans-serif;
            /* Puedes cambiar la fuente según tus preferencias */
        }

        .contenido {
            padding: 20px;
            color: #fff;
            /* Color del texto, puedes ajustarlo según tu imagen de fondo */
        }

        label {
            display: block;
        }

        input {
            padding-right: 100px;
        }
    </style>
</head>

<body>
    <div class="contenido">
        <h3 style="text-align: center;">Formulario Venta de VideoJuegos</h3>
        <center>
            <form action="">
                Por favor llene el siguiente formulario:
                <br>
                <br>
                <label for="nombre"><b>Nombre: </b></label>
                <input type="text" id="nombre">
                <br>
                <br>
                <label for="correo"><b>Correo Electrónico:</b> </label>
                <input type="email" id="correo">
                <br>
                <br>
                <label for="videojuego"><b>Videojuego:</b> </label>
                <input type="text" name="" id="videojuego">
                <br>
                <br>
                <label for="plataforma"><b>Plataforma: </b></label>
                <select id="plataforma" name="">
                    <option value="PlayStation 4">PlayStation 4</option>
                    <option value="PlayStation 5">PlayStation 5</option>
                    <option value="Xbox Series X/S">Xbox Series X/S</option>
                    <option value="Nintendo Switch">Nintendo Switch</option>
                    <!-- Agrega más opciones según sea necesario -->
                </select>
                <br>
                <br>
                <label for="cantidad"><b>Cantidad:</b> </label>
                <input type="number" name="" id="cantidad">
                <br>
                <br>
                <button type="button" onclick="crearRegistro()">Enviar</button>
            </form>
        </center>
        <br>
        <br>

        <div class="container">
            <table class="table table-hover">
                <h3 style="text-align: center;">Datos de tus Videojuegos</h3>
                <thead>
                    <tr>
                        <th>NOMBRE</th>
                        <th>CORREO ELECTRONICO</th>
                        <th>VIDEOJUEGO</th>
                        <th>PLATAFORMA</th>
                        <th>CANTIDAD</th>
                        <th>ACCIONES</th>
                    </tr>
                </thead>
                <tbody id="tablaDatos">
                </tbody>
            </table>
        </div>

        <!-- Modal para la edición -->
        <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Editar Registro</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <!-- Formulario para editar -->
                        <label for="edit-nombre"><b>Nombre: </b></label>
                        <input type="text" id="edit-nombre">
                        <br>
                        <br>
                        <label for="edit-correo"><b>Correo Electrónico:</b> </label>
                        <input type="email" id="edit-correo">
                        <br>
                        <br>
                        <label for="edit-videojuego"><b>Videojuego:</b> </label>
                        <input type="text" id="edit-videojuego">
                        <br>
                        <br>
                        <label for="edit-plataforma"><b>Plataforma: </b></label>
                        <select id="edit-plataforma" name="">
                            <option value="PlayStation 4">PlayStation 4</option>
                            <option value="PlayStation 5">PlayStation 5</option>
                            <option value="Xbox Series X/S">Xbox Series X/S</option>
                            <option value="Nintendo Switch">Nintendo Switch</option>
                            <!-- Agrega más opciones según sea necesario -->
                        </select>
                        <br>
                        <br>
                        <label for="edit-cantidad"><b>Cantidad:</b> </label>
                        <input type="number" id="edit-cantidad">
                        <br>
                        <br>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                        <button type="button" class="btn btn-primary" onclick="actualizarRegistro()">Guardar
                            cambios</button>
                    </div>
                </div>
            </div>
        </div>

        <script type="module">
            // Import the functions you need from the SDKs you need
            import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
            import { getDatabase, ref, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";
            // TODO: Add SDKs for Firebase products that you want to use
            // https://firebase.google.com/docs/web/setup#available-libraries

            // Your web app's Firebase configuration
            const firebaseConfig = {
                apiKey: "AIzaSyCFmywA9G6FIT4oOd2KtX9QhNRwKNKa3Y4",
                authDomain: "pro-septimo.firebaseapp.com",
                databaseURL: "https://pro-septimo-default-rtdb.firebaseio.com",
                projectId: "pro-septimo",
                storageBucket: "pro-septimo.appspot.com",
                messagingSenderId: "549825480403",
                appId: "1:549825480403:web:081982af9583715d08b626"
            };

            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const database = getDatabase(app);

            // Mostrar los datos de la tabla
            function mostrarDatosEnTabla() {
                const tableBody = document.getElementById("tablaDatos");

                onValue(ref(database, 'Christian'), (snapshot) => {
                    tableBody.innerHTML = ''; // Limpiar la tabla antes de actualizar
                    snapshot.forEach((childSnapshot) => {
                        const data = childSnapshot.val();
                        const row = `<tr>
                        <td>${data.name}</td>
                        <td>${data.mail}</td>
                        <td>${data.videogame}</td>
                        <td>${data.platform}</td>
                        <td>${data.cant}</td>
                        <td>
                          <button data-bs-toggle="modal" data-bs-target="#editModal" onclick="cargarDatosParaEditar('${childSnapshot.key}')">Editar</button>

                          <button onclick="eliminarRegistro('${childSnapshot.key}')">Eliminar</button>
                        </td>
                    </tr>`;
                        tableBody.innerHTML += row;
                    });
                });
            }

            // Llama a esta función para cargar los datos al cargar la página
            mostrarDatosEnTabla();

            // Función para cargar datos en el formulario de edición
            window.cargarDatosParaEditar = function (key) {
                const nombre = document.getElementById("edit-nombre");
                const correo = document.getElementById("edit-correo");
                const videojuego = document.getElementById("edit-videojuego");
                const plataforma = document.getElementById("edit-plataforma");
                const cantidad = document.getElementById("edit-cantidad");

                onValue(ref(database, 'Christian/' + key), (snapshot) => {
                    const data = snapshot.val();
                    nombre.value = data.name;
                    correo.value = data.mail;
                    videojuego.value = data.videogame;
                    plataforma.value = data.platform;
                    cantidad.value = data.cant;
                });
            };

            // Función para actualizar un registro
            window.actualizarRegistro = function () {
                const key = document.getElementById("edit-key").value;
                const nombre = document.getElementById("edit-nombre").value;
                const correo = document.getElementById("edit-correo").value;
                const videojuego = document.getElementById("edit-videojuego").value;
                const plataforma = document.getElementById("edit-plataforma").value;
                const cantidad = document.getElementById("edit-cantidad").value;

                // Actualizar el registro en la base de datos
                update(ref(database, 'Christian/' + key), {
                    name: nombre,
                    mail: correo,
                    videogame: videojuego,
                    platform: plataforma,
                    cant: cantidad
                });

                // Ocultar el modal después de actualizar
                const editModal = new bootstrap.Modal(document.getElementById('editModal'));
                editModal.hide();

                // Luego de actualizar, cargar nuevamente los datos
                mostrarDatosEnTabla();
            };

            window.crearRegistro = function () {
                const nombre = document.getElementById("nombre").value;
                const correo = document.getElementById("correo").value;
                const videojuego = document.getElementById("videojuego").value;
                const plataforma = document.getElementById("plataforma").value;
                const cantidad = document.getElementById("cantidad").value;
                console.log(nombre, correo, videojuego, plataforma, cantidad);

                push(
                    ref(database, 'Christian'),
                    {
                        name: nombre,
                        mail: correo,
                        videogame: videojuego,
                        platform: plataforma,
                        cant: cantidad
                    }
                );

            }

            window.eliminarRegistro = function (key) {
                remove(ref(database, 'Christian/' + key));
                // Luego de eliminar, cargar nuevamente los datos
                mostrarDatosEnTabla();
            }
        </script>
    </div>
    
</body>

</html>
